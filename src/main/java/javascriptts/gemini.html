<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Asynchronous Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 0; }
            80%, 100% { opacity: 0; }
        }
        .async-dot {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .code-block {
            background-color: #0f172a;
            color: #94a3b8;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        .keyword { color: #f472b6; }
        .func { color: #38bdf8; }
        .string { color: #4ade80; }
        .comment { color: #64748b; }
        .preferred { border: 2px solid #6366f1; position: relative; }
        .preferred::after {
            content: "PREFERRED WAY";
            position: absolute;
            top: -12px;
            right: 10px;
            background: #6366f1;
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

<div class="max-w-4xl mx-auto p-6 lg:p-12">
    <header class="mb-12 border-b pb-8">
        <h1 class="text-4xl font-bold text-indigo-700 mb-4">Understanding JS Asynchronicity</h1>
        <p class="text-lg text-slate-600">JavaScript is single-threaded. Asynchronicity allows it to "delegate" long-running tasks so the main thread stays responsive.</p>
    </header>

    <!-- Interactive Playground -->
    <section class="bg-white rounded-2xl shadow-xl overflow-hidden mb-12 border border-slate-200">
        <div class="p-6 bg-slate-900 text-white flex justify-between items-center">
            <h2 class="text-xl font-semibold">Live Simulation</h2>
            <div id="status-badge" class="px-3 py-1 rounded-full text-xs font-mono bg-green-500/20 text-green-400 border border-green-500/50">THREAD IDLE</div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2">
            <div class="p-6 border-r border-slate-100">
                <canvas id="asyncCanvas" class="w-full h-64 bg-slate-50 rounded-lg border border-slate-200"></canvas>
                <p class="mt-4 text-sm text-slate-500 italic text-center">The ball bounces at 60fps. If the thread blocks, it stops.</p>
            </div>

            <div class="p-6 flex flex-col gap-4">
                <div>
                    <h3 class="font-bold mb-2 text-sm uppercase text-slate-400">The "Bad" Way (Sync)</h3>
                    <button id="btnSync" class="w-full py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition shadow-md active:scale-95">
                        Block Thread (3s)
                    </button>
                </div>

                <div>
                    <h3 class="font-bold mb-2 text-sm uppercase text-slate-400">Fetching Data</h3>
                    <div class="flex flex-col gap-2">
                        <button id="btnFetchOld" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition shadow-md text-xs">
                            Fetch (Older .then() Style)
                        </button>
                        <button id="btnFetch" class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition shadow-md text-xs font-bold">
                            Fetch (Modern Async/Await)
                        </button>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold mb-2 text-sm uppercase text-slate-400">Legacy Patterns</h3>
                    <button id="btnCallback" class="w-full py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition shadow-md text-xs">
                        Callbacks (The Nesting Way)
                    </button>
                </div>
            </div>
        </div>

        <div id="log" class="bg-slate-800 p-4 font-mono text-xs text-indigo-300 h-40 overflow-y-auto border-t border-slate-700">
            > System ready.
        </div>
    </section>

    <!-- New: Style Comparison -->
    <article class="prose prose-slate max-w-none mb-16">
        <h2 class="text-3xl font-bold text-slate-800 mb-6">Older vs. Newer Style</h2>

        <div class="grid grid-cols-1 gap-8">
            <!-- Older Style -->
            <div>
                <h3 class="text-lg font-bold text-slate-700">1. Older Style: Promise Chaining (.then)</h3>
                <p class="text-sm text-slate-600 mb-2">This was the "gold standard" before 2017. It uses <code>.then()</code> to handle success and <code>.catch()</code> for errors.</p>
                <div class="code-block">
                    <span class="func">fetch</span>(<span class="string">'url'</span>)<br>
                    &nbsp;&nbsp;.<span class="func">then</span>(response => response.<span class="func">json</span>()) <span class="comment">// Returns another promise</span><br>
                    &nbsp;&nbsp;.<span class="func">then</span>(data => {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.<span class="func">log</span>(data);<br>
                    &nbsp;&nbsp;})<br>
                    &nbsp;&nbsp;.<span class="func">catch</span>(err => {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.<span class="func">error</span>(err);<br>
                    &nbsp;&nbsp;});
                </div>
            </div>

            <!-- Preferred Style -->
            <div>
                <h3 class="text-lg font-bold text-slate-700">2. Modern Style: Async / Await</h3>
                <p class="text-sm text-slate-600 mb-2">This is the <strong>preferred way</strong>. It reads like a book (top to bottom) and makes error handling easier with <code>try/catch</code>.</p>
                <div class="code-block preferred">
                    <span class="keyword">async function</span> <span class="func">getData</span>() {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="func">fetch</span>(<span class="string">'url'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="func">json</span>();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.<span class="func">log</span>(data);<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (err) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.<span class="func">error</span>(err);<br>
                    &nbsp;&nbsp;}<br>
                    }
                </div>
            </div>
        </div>

        <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 my-8">
            <h4 class="font-bold text-indigo-800 mb-2">Why is Async/Await preferred?</h4>
            <ul class="text-sm text-indigo-900/70 list-disc pl-5 space-y-2">
                <li><strong>Readability:</strong> No more "pyramid" structure or long chaining.</li>
                <li><strong>Debugging:</strong> You can set breakpoints on <code>await</code> lines easily.</li>
                <li><strong>Error Handling:</strong> Standard <code>try/catch</code> works for both sync and async code.</li>
            </ul>
        </div>
    </article>

    <!-- Fetch API for Newbies -->
    <article class="prose prose-slate max-w-none mb-16">
        <h2 class="text-3xl font-bold text-slate-800 mb-6">The Fetch API (Getting Data)</h2>
        <p class="text-slate-600 leading-relaxed">
            The <code>fetch()</code> function is how we talk to servers. Remember the <strong>Two-Step Rule</strong>: Fetch the response, then parse the JSON.
        </p>
    </article>

    <!-- What is a Callback Section -->
    <article class="prose prose-slate max-w-none mb-16">
        <h2 class="text-3xl font-bold text-slate-800 mb-6">Deep Dive: What is a Callback?</h2>
        <p class="text-slate-600 leading-relaxed">
            A <strong>Callback</strong> is a function passed as an argument. It is the "grandfather" of asynchronicity in JS.
        </p>
    </article>
</div>

<script>
        (function() {
            const canvas = document.getElementById('asyncCanvas');
            const ctx = canvas.getContext('2d');
            const logEl = document.getElementById('log');
            const badge = document.getElementById('status-badge');

            // Animation State
            let ballX = 50;
            let ballY = 50;
            let velX = 2.5;
            let velY = 2.5;
            const ballRadius = 15;

            function resize() {
                if (canvas && canvas.parentElement) {
                    canvas.width = canvas.parentElement.clientWidth;
                    canvas.height = canvas.parentElement.clientHeight;
                }
            }
            window.addEventListener('resize', resize);
            resize();

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
                ctx.fillStyle = '#6366f1';
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#6366f1';
                ctx.fill();
                ctx.closePath();

                if (ballX + velX > canvas.width - ballRadius || ballX + velX < ballRadius) velX = -velX;
                if (ballY + velY > canvas.height - ballRadius || ballY + velY < ballRadius) velY = -velY;

                ballX += velX;
                ballY += velY;

                requestAnimationFrame(draw);
            }
            draw();

            function log(msg, type = 'info') {
                const time = new Date().toLocaleTimeString().split(' ')[0];
                const div = document.createElement('div');
                div.className = type === 'error' ? 'text-red-400' : (type === 'warn' ? 'text-amber-300' : (type === 'success' ? 'text-green-400' : 'text-indigo-300'));
                div.innerHTML = `<span class="opacity-50">[${time}]</span> > ${msg}`;
                logEl.prepend(div);
            }

            function setStatus(status, isBusy) {
                badge.innerText = status;
                badge.className = isBusy
                    ? 'px-3 py-1 rounded-full text-xs font-mono bg-red-500/20 text-red-400 border border-red-500/50'
                    : 'px-3 py-1 rounded-full text-xs font-mono bg-green-500/20 text-green-400 border border-green-500/50';
            }

            // --- Handlers ---

            function runSync() {
                log('CRITICAL: Blocking Thread for 3s...', 'error');
                setStatus('THREAD BLOCKED!', true);
                setTimeout(() => {
                    const start = Date.now();
                    while (Date.now() - start < 3000) {}
                    log('Thread released!', 'info');
                    setStatus('THREAD IDLE', false);
                }, 50);
            }

            function runCallback() {
                log('Callback Chain Started...', 'warn');
                setTimeout(() => {
                    log('Step 1 Done');
                    setTimeout(() => {
                        log('Step 2 Done');
                        log('Sequence Complete!', 'warn');
                    }, 1000);
                }, 1000);
            }

            // Older Promise Style (.then)
            function runFetchOld() {
                log('Fetch using Older .then() Style...', 'info');
                setStatus('FETCHING...', true);

                fetch('https://randomuser.me/api/')
                    .then(response => response.json())
                    .then(data => {
                        const user = data.results[0];
                        log(`.then() Success: Found ${user.name.first}`, 'success');
                    })
                    .catch(err => {
                        log('Error: ' + err.message, 'error');
                    })
                    .finally(() => {
                        setStatus('THREAD IDLE', false);
                    });
            }

            // Modern Async/Await Style
            async function runFetchModern() {
                log('Fetch using Modern Async/Await...', 'info');
                setStatus('FETCHING...', true);
                try {
                    const response = await fetch('https://randomuser.me/api/');
                    const data = await response.json();
                    const user = data.results[0];
                    log(`Async/Await Success: Found ${user.name.first}`, 'success');
                } catch (err) {
                    log('Error: ' + err.message, 'error');
                } finally {
                    setStatus('THREAD IDLE', false);
                }
            }

            document.getElementById('btnSync').addEventListener('click', runSync);
            document.getElementById('btnCallback').addEventListener('click', runCallback);
            document.getElementById('btnFetchOld').addEventListener('click', runFetchOld);
            document.getElementById('btnFetch').addEventListener('click', runFetchModern);
        })();
    </script>
</body>
</html>